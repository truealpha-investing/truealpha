<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard | True Alpha</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
  </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

  <!-- NAV -->
  <nav class="w-full border-b border-gray-800 bg-gray-900/90 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
        <span class="font-bold text-xl tracking-tight text-white">TRUE<span class="text-green-500">ALPHA</span></span>
      </a>
      <div class="text-xs text-gray-500 font-mono hidden sm:block">DASHBOARD</div>
    </div>
  </nav>

  <main class="flex-grow max-w-7xl mx-auto px-4 py-10">
    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-8">
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">Leaderboard</h1>
        <p class="text-gray-400 mt-2">Quick scan of creator performance — alpha, accuracy, and what they recommend.</p>
      </div>
      <div class="text-xs text-gray-400 font-mono">
        <span id="lastUpdated">Last Updated: —</span>
        <span class="mx-2 text-gray-700">|</span>
        <span id="threshold">Filter: Verified (N &gt; —)</span>
      </div>
    </div>

    <!-- GRID OF CARDS -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

      <!-- Alpha Card -->
      <section class="glass rounded-2xl p-6 md:col-span-1">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-bold text-white">Top Performers</h2>
          <span class="text-xs text-green-400 font-mono">AVG ALPHA</span>
        </div>
        <div id="alphaTop" class="space-y-3 text-sm"></div>

        <div class="border-t border-gray-800 my-5"></div>

        <div class="flex items-center justify-between mb-4">
          <h2 class="font-bold text-white">Underperformers</h2>
          <span class="text-xs text-red-400 font-mono">AVG ALPHA</span>
        </div>
        <div id="alphaBottom" class="space-y-3 text-sm"></div>
      </section>

      <!-- Accuracy Card -->
      <section class="glass rounded-2xl p-6 md:col-span-1">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-bold text-white">Most Accurate</h2>
          <span class="text-xs text-green-400 font-mono">WIN RATE</span>
        </div>
        <div id="accTop" class="space-y-3 text-sm"></div>

        <div class="border-t border-gray-800 my-5"></div>

        <div class="flex items-center justify-between mb-4">
          <h2 class="font-bold text-white">Least Accurate</h2>
          <span class="text-xs text-red-400 font-mono">WIN RATE</span>
        </div>
        <div id="accBottom" class="space-y-3 text-sm"></div>
      </section>

      <!-- Stocks Card -->
      <section class="glass rounded-2xl p-6 md:col-span-1">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-bold text-white" id="stocksTitle">Stocks Recommended</h2>
          <span class="text-xs text-blue-300 font-mono">TOP CREATOR SIGNALS</span>
        </div>
        <div id="stocksList" class="space-y-3 text-sm"></div>

        <div class="border-t border-gray-800 my-5"></div>

        <div class="text-xs text-gray-400 leading-relaxed">
          Tip: this is most useful when it’s limited to <span class="text-white font-semibold">verified creators only</span>.
        </div>
      </section>

      <!-- Interval Performance Card (wide) -->
      <section class="glass rounded-2xl p-6 md:col-span-3">
        <div class="flex items-center justify-between mb-6">
          <h2 class="font-bold text-white" id="intervalTitle">Creator Performance by Time Interval</h2>
          <span class="text-xs text-gray-400 font-mono">SHORT vs LONG HORIZON</span>
        </div>

        <div id="intervalGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
      </section>

    </div>

    <div class="mt-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <p class="text-xs text-gray-500 font-mono">Metric: Average Alpha vs S&P 500 (unless otherwise noted)</p>
      <a href="https://docs.google.com/spreadsheets/d/1VOSiF48EhsFYupdIHfA48CgEtdE5x9HaQXhr4BskGeU/edit?gid=1231233657#gid=1231233657"
         target="_blank"
         class="inline-flex items-center justify-center rounded-lg px-4 py-2 bg-gray-800 hover:bg-green-600 transition text-sm font-bold">
        View Full Database →
      </a>
    </div>
  </main>

  <footer class="border-t border-gray-800 bg-gray-900 py-10 mt-10">
    <div class="max-w-7xl mx-auto px-4 text-xs text-gray-600">
      © 2025 True Alpha Research — Not financial advice. Data for entertainment & analysis purposes only.
    </div>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);

    function fmtSignedPct(n, digits=2) {
      const num = Number(n);
      const sign = num > 0 ? "+" : "";
      return `${sign}${num.toFixed(digits)}%`;
    }

    function miniRow({ rank, creator, value, n }, opts) {
      const isGood = opts.mode === "good";
      const valueClass = isGood ? "text-green-400" : "text-red-400";
      const pillClass = isGood ? "bg-green-500/10 border-green-500/30 text-green-300" : "bg-red-500/10 border-red-500/30 text-red-300";

      return `
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-3 min-w-0">
            <div class="w-6 h-6 flex items-center justify-center rounded-full border ${pillClass} text-xs font-bold shrink-0">${rank}</div>
            <div class="min-w-0">
              <div class="text-white font-semibold truncate">${creator}</div>
              <div class="text-[11px] text-gray-500 font-mono">n=${n ?? "—"}</div>
            </div>
          </div>
          <div class="font-mono font-bold ${valueClass} shrink-0">${fmtSignedPct(value)}</div>
        </div>
      `;
    }

    function stockRow({ ticker, mentions }) {
      return `
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            <div class="w-10 text-center font-mono font-bold text-white">${ticker}</div>
            <div class="text-[11px] text-gray-500 font-mono">${mentions} mentions</div>
          </div>
          <div class="text-xs text-blue-300 font-mono">signal</div>
        </div>
      `;
    }

    function intervalCard(interval) {
      const top = (interval.top || []).map(x => `
        <div class="flex items-center justify-between">
          <div class="truncate text-gray-200">${x.creator}</div>
          <div class="font-mono font-bold text-green-400">${fmtSignedPct(x.value)}</div>
        </div>
      `).join("");

      const bottom = (interval.bottom || []).map(x => `
        <div class="flex items-center justify-between">
          <div class="truncate text-gray-200">${x.creator}</div>
          <div class="font-mono font-bold text-red-400">${fmtSignedPct(x.value)}</div>
        </div>
      `).join("");

      return `
        <div class="rounded-xl border border-gray-800 p-5 bg-black/10">
          <div class="flex items-center justify-between mb-4">
            <div class="font-bold text-white">${interval.label}</div>
            <div class="text-[11px] text-gray-500 font-mono">alpha</div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <div class="text-xs text-green-300 font-mono mb-2">Top</div>
              <div class="space-y-2 text-sm">${top || `<div class="text-sm text-gray-500">—</div>`}</div>
            </div>
            <div>
              <div class="text-xs text-red-300 font-mono mb-2">Bottom</div>
              <div class="space-y-2 text-sm">${bottom || `<div class="text-sm text-gray-500">—</div>`}</div>
            </div>
          </div>
        </div>
      `;
    }

    async function loadDashboard() {
      try {
        const res = await fetch("./dashboard.json", { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        $("lastUpdated").textContent = `Last Updated: ${data.lastUpdated || "—"}`;
        $("threshold").textContent = `Filter: Verified (N > ${data.minThreshold ?? "—"})`;

        // Alpha
        $("alphaTop").innerHTML = (data.alpha?.top || []).slice(0,4).map((r,i)=>miniRow(r,{mode:"good"})).join("");
        $("alphaBottom").innerHTML = (data.alpha?.bottom || []).slice(0,4).map((r,i)=>miniRow(r,{mode:"bad"})).join("");

        // Accuracy
        $("accTop").innerHTML = (data.accuracy?.top || []).slice(0,4).map((r)=>miniRow(r,{mode:"good"})).join("");
        $("accBottom").innerHTML = (data.accuracy?.bottom || []).slice(0,4).map((r)=>miniRow(r,{mode:"bad"})).join("");

        // Stocks
        if (data.recommendedStocks?.title) $("stocksTitle").textContent = data.recommendedStocks.title;
        $("stocksList").innerHTML = (data.recommendedStocks?.items || []).slice(0,6).map(stockRow).join("");

        // Intervals
        if (data.intervalPerformance?.title) $("intervalTitle").textContent = data.intervalPerformance.title;
        $("intervalGrid").innerHTML = (data.intervalPerformance?.intervals || []).map(intervalCard).join("");

      } catch (e) {
        console.error(e);
        $("alphaTop").innerHTML = `<div class="text-sm text-red-400">Failed to load dashboard.json</div>`;
        $("alphaBottom").innerHTML = `<div class="text-sm text-red-400">Failed to load dashboard.json</div>`;
        $("accTop").innerHTML = `<div class="text-sm text-red-400">Failed to load dashboard.json</div>`;
        $("accBottom").innerHTML = `<div class="text-sm text-red-400">Failed to load dashboard.json</div>`;
        $("stocksList").innerHTML = `<div class="text-sm text-red-400">Failed to load dashboard.json</div>`;
        $("intervalGrid").innerHTML = `<div class="text-sm text-red-400">Failed to load dashboard.json</div>`;
      }
    }

    loadDashboard();
  </script>
</body>
</html>
